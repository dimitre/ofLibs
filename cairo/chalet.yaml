# UNUSED YET

name: oflibs
version: "1.0"
externalDependencies:
  cairo:
    repository: https://gitlab.freedesktop.org/cairo/cairo
    # tag: 1.18.4
    commit: 04656d7450e229622546fd2b11496aa58c44181d
    kind: git
targets:
  cairo:
    kind: mesonProject
    location: ${external:${name}}
    install: true
    defines:
      - buildtype=release
      - default_library=static
      # if disabled meson fails with  ERROR: C prefer_static library 'gdi32' not found
      # - default_both_libraries=static
      # - prefer_static=true

      - tests=disabled

      - xcb=disabled
      - xlib=disabled
      - lzo=disabled

      - dwrite=disabled
      - fontconfig=disabled
      - freetype=disabled

    # temporary, only to make it work on MSYS cross compile (hopefully) before Chalet fixes.
    # FIXME: Remove when this is closed https://github.com/chalet-org/chalet/issues/425
    defines[toolchain:{aarch64-linux-gnu-gcc,arm-linux-gnueabihf-gcc}]:
      - skip_sanity_checks=true
      - prefix=raspbian

    defines[platform:macos]:
      - c_args=-mmacos-version-min=11.6
      - cpp_args=-mmacos-version-min=11.6

      # I had to reenable those 4 to make it work
      # - png=disabled
      # - quartz=disabled
      # - zlib=disabled
      # - spectre=disabled

      # - tee=disabled
      # - xcb=disabled
      # - xlib=disabled
      # - xlib-xcb=disabled

      # - lzo=disabled
      # - gtk2-utils=disabled
      # - glib=disabled
      # - symbol-lookup=disabled

distribution:
  cairo:
    kind: archive
    format: zip
    include:
      - ${external:${name}}/COPYING*

    include[platform:macos]:
      - ${externalBuild:${name}}/install/opt/homebrew/include
      - ${externalBuild:${name}}/install/opt/homebrew/lib
      - ${externalBuild:${name}}/install/usr/local/include
      - ${externalBuild:${name}}/install/usr/local/lib
    include[platform:windows]:
      - ${externalBuild:${name}}/install/include
      - ${externalBuild:${name}}/install/lib
    include[platform:linux]:
      - ${externalBuild:${name}}/install/usr/local/include
      - ${externalBuild:${name}}/install/usr/local/lib

      # - ${externalBuild:${name}}/src/*.a
      # - ${externalBuild:${name}}/src/*.h
