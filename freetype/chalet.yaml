name: oflibs
version: "1.0"
externalDependencies:
  # zlib:
  #   repository: https://github.com/madler/zlib
  #   # tag: v1.3.1
  #   commit: 5a82f71
  #   kind: git
  freetype:
    repository: https://gitlab.freedesktop.org/freetype/freetype
    tag: VER-2-14-1
    kind: git
targets:
  libjpeg:
    kind: chaletProject
    location: ../libjpeg
    rebuild: false
  brotli:
    kind: chaletProject
    location: ../brotli
    rebuild: false
  libpng:
    kind: chaletProject
    location: ../libpng
    rebuild: false
  # this is already added in libpng
  zlib-ng:
    kind: chaletProject
    location: ../zlib-ng
    rebuild: false

  freetype:
    kind: cmakeProject
    location: ${external:${name}}
    recheck: false
    rebuild: false
    install: true
    defines:
      # - CMAKE_ARCHIVE_OUTPUT_DIRECTORY=lib
      # FIXME: Temporary
      # - CMAKE_ARCHIVE_OUTPUT_DIRECTORY=lib/macos
      - BUILD_SHARED_LIBS=OFF
      - CMAKE_BUILD_TYPE=Release
      - CMAKE_POSITION_INDEPENDENT_CODE=ON
      - CMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded

      - FT_DISABLE_BZIP2=ON
      - FT_REQUIRE_HARFBUZZ=OFF
      - FT_DISABLE_HARFBUZZ=ON
      - FT_REQUIRE_ZLIB=ON

      - CMAKE_PREFIX_PATH=${cwd}/${externalBuild:libpng}/ext.zlib-ng/install
      - ZLIB_ROOT=${cwd}/${externalBuild:libpng}/ext.zlib-ng/install
      - ZLIB_LIBRARY=${cwd}/${externalBuild:libpng}/ext.zlib-ng/install/lib
      - ZLIB_INCLUDE_DIR=${cwd}/${externalBuild:libpng}/ext.zlib-ng/install/include

      # - CMAKE_PREFIX_PATH=${cwd}/${externalBuild:zlib-ng}/ext.zlib-ng/install
      # - ZLIB_ROOT=${cwd}/${externalBuild:zlib-ng}/ext.zlib-ng/install
      # - ZLIB_LIBRARY=${cwd}/${externalBuild:zlib-ng}/ext.zlib-ng/install/lib
      # - ZLIB_INCLUDE_DIR=${cwd}/${externalBuild:zlib-ng}/ext.zlib-ng/install/include

      - LibJPEG_ROOT=${cwd}/${externalBuild:libjpeg}/ext.libjpeg/install

      - BROTLI_ROOT=${cwd}/${externalBuild:brotli}/ext.brotli/install
      - BROTLI_LIBRARY=${cwd}/${externalBuild:brotli}/ext.brotli/install/lib
      - BROTLIDEC_INCLUDE_DIRS=${cwd}/${externalBuild:brotli}/ext.brotli/install/include
      - BROTLIDEC_LIBRARIES=${cwd}/${externalBuild:brotli}/ext.brotli/install/lib

      - PNG_ROOT=${cwd}/${externalBuild:libpng}/ext.libpng/install
      - PNG_LIBRARY=${cwd}/${externalBuild:libpng}/ext.libpng/install/lib
      - PNG_PNG_INCLUDE_DIR=${cwd}/${externalBuild:libpng}/ext.libpng/install/include

    # -- Could NOT find ZLIB (missing: ZLIB_INCLUDE_DIR)
    # -- Found PNG: build/x86_64-pc-windows-msvc_Release/ext.libpng/ext.libpng/install/lib
    # -- Could NOT find ZLIB (missing: ZLIB_INCLUDE_DIR)
    # -- Could NOT find BrotliDec (missing: BROTLIDEC_INCLUDE_DIRS BROTLIDEC_LIBRARIES)

    # defines[platform:!windows]:
    # - ZLIB_INCLUDE_DIRS=${external:zlib}
    # - ZLIB_INCLUDE_DIR=${external:zlib}
    defines[platform:macos]:
      - CMAKE_OSX_DEPLOYMENT_TARGET=11.6
      - CMAKE_OSX_ARCHITECTURES=x86_64;arm64

distribution:
  freetype:
    kind: archive
    format: zip
    include:
      - ${external:${name}}/LICENSE**
      - ${externalBuild:${name}}/install/include
      - ${externalBuild:${name}}/install/lib
      # - ${externalBuild:${name}}/${ar:${name}}
