name: oflibs
version: "1.0"
externalDependencies:
  # zlib:
  #   repository: https://github.com/madler/zlib
  #   # tag: v1.3.1
  #   commit: 5a82f71
  #   kind: git
  freetype:
    repository: https://gitlab.freedesktop.org/freetype/freetype
    tag: VER-2-14-1
    kind: git
targets:
  zlib:
    kind: chaletProject
    location: ../zlib
    rebuild: false
  libpng:
    kind: chaletProject
    location: ../libpng
    rebuild: false
  brotli:
    kind: chaletProject
    location: ../brotli
    rebuild: false
  # zlib:
  #   kind: cmakeProject
  #   location: ${external:${name}}
  #   recheck: false
  #   rebuild: false
  #   defines:
  #     - ZLIB_BUILD_TESTING=OFF
  #     - ZLIB_BUILD_SHARED=OFF
  #     - ZLIB_BUILD_EXAMPLES=OFF
  #     - BUILD_SHARED_LIBS=OFF # not working on zlib
  #     - CMAKE_BUILD_TYPE=Release
  #     - CMAKE_POSITION_INDEPENDENT_CODE=ON
  #     - CMAKE_INSTALL_PREFIX=Release
  #   defines[platform:web]:
  #     - JS_ONLY=ON
  #     - CMAKE_EXECUTABLE_SUFFIX=.js
  #   defines[platform:macos]:
  #     - CMAKE_OSX_ARCHITECTURES=x86_64;arm64
  #     - CMAKE_OSX_DEPLOYMENT_TARGET=11.6
  freetype:
    kind: cmakeProject
    location: ${external:${name}}
    recheck: false
    rebuild: false
    install: true
    defines:
      # - CMAKE_ARCHIVE_OUTPUT_DIRECTORY=lib
      # FIXME: Temporary
      # - CMAKE_ARCHIVE_OUTPUT_DIRECTORY=lib/macos
      - BUILD_SHARED_LIBS=OFF
      - CMAKE_BUILD_TYPE=Release
      - CMAKE_POSITION_INDEPENDENT_CODE=ON
      - FT_DISABLE_BZIP2=ON
      - FT_REQUIRE_HARFBUZZ=OFF
      - FT_DISABLE_HARFBUZZ=ON
      - ZLIB_ROOT=${externalBuild:zlib}/ext.zlib/install
      - ZLIB_LIBRARY=${externalBuild:zlib}/ext.zlib/install/lib
      - ZLIB_INCLUDE_DIR=${externalBuild:zlib}/ext.zlib/install/include
      - BROTLI_ROOT=${externalBuild:brotli}/ext.brotli/install
      - BROTLI_LIBRARY=${externalBuild:brotli}/ext.brotli/install/lib
      - PNG_ROOT=${externalBuild:libpng}/ext.libpng/install
      - PNG_LIBRARY=${externalBuild:libpng}/ext.libpng/install/lib
      - PNG_PNG_INCLUDE_DIR=${externalBuild:libpng}/ext.libpng/install/include
      - BROTLIDEC_INCLUDE_DIRS=${externalBuild:brotli}/ext.brotli/install/include
      - BROTLIDEC_LIBRARIES=${externalBuild:brotli}/ext.brotli/install/lib

    # -- Could NOT find ZLIB (missing: ZLIB_INCLUDE_DIR)
    # -- Found PNG: build/x86_64-pc-windows-msvc_Release/ext.libpng/ext.libpng/install/lib
    # -- Could NOT find ZLIB (missing: ZLIB_INCLUDE_DIR)
    # -- Could NOT find BrotliDec (missing: BROTLIDEC_INCLUDE_DIRS BROTLIDEC_LIBRARIES)

    # defines[platform:!windows]:
    # - ZLIB_INCLUDE_DIRS=${external:zlib}
    # - ZLIB_INCLUDE_DIR=${external:zlib}
    defines[platform:macos]:
      - CMAKE_OSX_DEPLOYMENT_TARGET=11.6
      - CMAKE_OSX_ARCHITECTURES=x86_64;arm64

distribution:
  freetype:
    kind: archive
    format: zip
    include:
      - ${external:${name}}/LICENSE**
      - ${externalBuild:${name}}/include
      - ${externalBuild:${name}}/install/lib
      # - ${externalBuild:${name}}/${ar:${name}}
